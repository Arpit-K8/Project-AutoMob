<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Confirmed - MechXpress</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out',
                        'fade-in-scale': 'fadeInScale 0.6s ease-out',
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'check-draw': 'checkDraw 0.8s ease-out 0.5s both',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes checkDraw {
            from {
                stroke-dasharray: 0 100;
            }
            to {
                stroke-dasharray: 100 0;
            }
        }
        .check-icon {
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
            animation: checkDraw 0.8s ease-out 0.5s both;
        }
        .rating-star {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .rating-star:hover {
            transform: scale(1.2);
        }
        .rating-star.filled {
            color: #fbbf24;
        }
        .rating-star.unfilled {
            color: #d1d5db;
        }
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-2">
                    <div class="flex items-center">
                        <img src="Image/Logo.png" alt="Logo" class="h-8 w-auto object-contain">
                        <span class="text-xl font-bold italic text-gray-900">
                            <span>Mech</span><span class="text-orange-600 text-2xl">X</span><span class="text-orange-600">press</span>
                        </span>
                    </div>
                </div>
                
                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="Home.html" class="text-gray-700 hover:text-blue-600 transition-colors duration-200 font-medium">Home</a>
                    <a href="Home.html#services" class="text-gray-700 hover:text-blue-600 transition-colors duration-200 font-medium">Services</a>
                    <a href="Booking.html" class="text-blue-600 transition-colors duration-200 font-medium">Bookings</a>
                    <a href="bookingHistory.html" class="text-gray-700 hover:text-blue-600 transition-colors duration-200 font-medium">History</a>
                    <a href="Reports.html" class="text-gray-700 hover:text-blue-600 transition-colors duration-200 font-medium">Reports</a>
                </div>

                <!-- User Profile -->
                <div class="flex items-center space-x-4">
                    <div class="hidden xl:block text-gray-700">
                        <span class="text-sm">Hi, <span id="userName" class="font-semibold text-blue-600">John Doe</span></span>
                    </div>
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-semibold text-sm" id="userInitials">JD</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Success Animation Container -->
        <div class="text-center mb-12">
            <div class="animate-fade-in-scale">
                <!-- Success Check Icon -->
                <div class="w-32 h-32 mx-auto mb-8 relative">
                    <div class="w-32 h-32 bg-green-100 rounded-full flex items-center justify-center">
                        <svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path class="check-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                </div>

                <!-- Success Message -->
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Booking Confirmed!</h1>
                <p class="text-xl text-gray-600 mb-8">Your service appointment has been successfully scheduled</p>
            </div>
        </div>

        <!-- Booking Details Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 animate-fade-in-up">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Booking Details</h2>
                <div class="px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
                    Confirmed
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Customer Information -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">Customer Information</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Name:</span>
                            <span class="font-medium" id="customerName">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Email:</span>
                            <span class="font-medium" id="customerEmail">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Phone:</span>
                            <span class="font-medium" id="customerPhone">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Address:</span>
                            <span class="font-medium text-right" id="customerAddress">-</span>
                        </div>
                    </div>
                </div>

                <!-- Service Information -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">Service Information</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Service:</span>
                            <span class="font-medium" id="serviceType">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Vehicle:</span>
                            <span class="font-medium" id="vehicleInfo">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Car Number:</span>
                            <span class="font-medium" id="carNumber">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Fuel Type:</span>
                            <span class="font-medium" id="fuelType">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Date:</span>
                            <span class="font-medium" id="appointmentDate">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Est. Time:</span>
                            <span class="font-medium text-blue-600" id="estimatedTime">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking ID -->
            <div class="mt-8 p-4 bg-blue-50 rounded-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h4 class="font-semibold text-blue-800">Booking ID</h4>
                        <p class="text-2xl font-bold text-blue-600" id="bookingId">MX-2025-001234</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-blue-700">Save this ID for future reference</p>
                        <button onclick="copyBookingId()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                            Copy ID
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Next Steps -->
        <div class="bg-white rounded-2xl shadow-xl p-8 animate-fade-in-up">
            <h3 class="text-xl font-bold text-gray-900 mb-6">What happens next?</h3>
            <div class="space-y-4">
                <div class="flex items-start space-x-4">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                        <span class="text-blue-600 font-bold text-sm">1</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">Confirmation Call</h4>
                        <p class="text-gray-600">Our team will call you within 30 minutes to confirm the appointment details</p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                        <span class="text-blue-600 font-bold text-sm">2</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">Technician Assignment</h4>
                        <p class="text-gray-600">A qualified technician will be assigned to your service</p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                        <span class="text-blue-600 font-bold text-sm">3</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">Service Completion</h4>
                        <p class="text-gray-600">Your vehicle will be serviced professionally and ready on time</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
            <a href="Home.html" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold text-center">
                Back to Dashboard
            </a>
            <a href="bookingHistory.html" class="px-8 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors font-semibold text-center">
                View All Bookings
            </a>
        </div>
    </main>

    <!-- Rating Modal -->
    <div id="ratingModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all">
            <div class="text-center">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Rate Your Experience</h3>
                <p class="text-gray-600 mb-6">How would you rate our booking process?</p>
                
                <!-- Star Rating -->
                <div class="flex justify-center space-x-2 mb-6">
                    <svg class="rating-star w-10 h-10 unfilled" data-rating="1" onclick="setRating(1)" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <svg class="rating-star w-10 h-10 unfilled" data-rating="2" onclick="setRating(2)" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <svg class="rating-star w-10 h-10 unfilled" data-rating="3" onclick="setRating(3)" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <svg class="rating-star w-10 h-10 unfilled" data-rating="4" onclick="setRating(4)" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <svg class="rating-star w-10 h-10 unfilled" data-rating="5" onclick="setRating(5)" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                </div>

                <!-- Comment Box -->
                <textarea id="ratingComment" placeholder="Tell us about your experience (optional)" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent mb-6 resize-none" 
                    rows="3"></textarea>

                <!-- Rating Buttons -->
                <div class="flex space-x-4">
                    <button onclick="skipRating()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        Skip
                    </button>
                    <button id="submitRatingBtn" onclick="submitRating()" disabled 
                        class="flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed">
                        Submit Rating
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Final Thank You Modal -->
    <div id="thankYouModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 text-center">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Thank You!</h3>
            <p id="thankYouMessage" class="text-gray-600 mb-6">Your feedback helps us improve our services</p>
            <button onclick="closeThankYou()" class="px-8 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                Continue
            </button>
        </div>
    </div>

    <!-- Admin Data Sent Notification -->
    <div id="adminNotification" class="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg hidden transform transition-all">
        <div class="flex items-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span>Booking data sent to admin panel</span>
        </div>
    </div>

    <script>
        // --- DATA MANAGEMENT ---
        function getUserData() {
            const defaultUser = {
                name: "John Doe",
                profileImage: null // No default image initially
            };
            const storedUser = localStorage.getItem('mechXpressUser');
            // If user data exists in storage, use it, otherwise use the default
            return storedUser ? JSON.parse(storedUser) : defaultUser;
        }

        // --- UI INITIALIZATION ---
        function initializeUser() {
            const user = getUserData();
            
            // Get name parts
            const nameParts = user.name.split(' ');
            const firstName = nameParts[0];
            const initials = nameParts.map(n => n[0]).join('').toUpperCase();

            // Populate text elements
            document.getElementById('userName').textContent = user.name;
            
            // Populate the user avatar in the navbar
            const navAvatarContainer = document.querySelector('.flex.items-center.space-x-4 .w-8.h-8');
            
            if (user.profileImage && user.profileImage.startsWith('data:image')) {
                // If a custom profile image is saved, display it
                navAvatarContainer.innerHTML = `<img src="${user.profileImage}" alt="User Avatar" class="w-full h-full object-cover rounded-full">`;
            } else {
                // Otherwise, display the initials
                navAvatarContainer.innerHTML = `<span class="text-white font-semibold text-sm">${initials}</span>`;
            }
        }

        // Rating variables
        let currentRating = 0;
        let ratingTimer;

        // Initialize page
        function initializePage() {
            // Initialize user data
            initializeUser();

            // Load booking data
            loadBookingData();

            // Generate booking ID
            generateBookingId();

            // Send data to admin panel
            sendToAdminPanel();

            // Start rating timer (1 minute)
            startRatingTimer();

            // Show admin notification
            showAdminNotification();
        }

        // Load booking data from sessionStorage
        function loadBookingData() {
            const bookingData = JSON.parse(sessionStorage.getItem('bookingData') || '{}');
            
            if (Object.keys(bookingData).length > 0) {
                // Customer Information
                document.getElementById('customerName').textContent = bookingData.fullName || '-';
                document.getElementById('customerEmail').textContent = bookingData.email || '-';
                document.getElementById('customerPhone').textContent = bookingData.phone || '-';
                document.getElementById('customerAddress').textContent = bookingData.address || '-';

                // Service Information
                document.getElementById('serviceType').textContent = formatServiceName(bookingData.service) || '-';
                document.getElementById('vehicleInfo').textContent = 
                    `${formatCarCompany(bookingData.carCompany)} ${bookingData.carModel}` || '-';
                document.getElementById('carNumber').textContent = bookingData.carNumber || '-';
                document.getElementById('fuelType').textContent = formatFuelType(bookingData.fuelType) || '-';
                document.getElementById('appointmentDate').textContent = formatDate(bookingData.appointmentDate) || '-';
                document.getElementById('estimatedTime').textContent = bookingData.estimatedTime || '-';
            } else {
                // No booking data found - redirect back to booking page
                console.error('No booking data found in sessionStorage');
                alert('No booking data found. Redirecting to booking page...');
                window.location.href = 'Booking.html';
            }
        }

        // Format service name
        function formatServiceName(service) {
            const serviceMap = {
                'preventive-maintenance': 'Preventive Maintenance',
                'body-repair': 'Body Repair',
                'car-care': 'Car Care Service',
                'engine-service': 'Engine Service',
                'interior-service': 'Interior Service',
                'tire-service': 'Tire Service',
                'diagnostic': 'Diagnostic Services',
                'brake-service': 'Brake System Service',
                'hybrid-electric': 'Hybrid/Electric Vehicle Services',
                'emergency': 'Emergency Roadside Assistance'
            };
            return serviceMap[service] || service;
        }

        // Format car company
        function formatCarCompany(company) {
            const companyMap = {
                'maruti-suzuki': 'Maruti Suzuki',
                'hyundai': 'Hyundai',
                'tata': 'Tata',
                'mahindra': 'Mahindra',
                'honda': 'Honda',
                'toyota': 'Toyota',
                'kia': 'Kia',
                'mg': 'MG Motors',
                'volkswagen': 'Volkswagen',
                'skoda': 'Skoda',
                'ford': 'Ford',
                'nissan': 'Nissan',
                'renault': 'Renault',
                'bmw': 'BMW',
                'mercedes': 'Mercedes-Benz',
                'audi': 'Audi',
                'other': 'Other'
            };
            return companyMap[company] || company;
        }

        // Format fuel type
        function formatFuelType(fuel) {
            const fuelMap = {
                'petrol': 'Petrol',
                'diesel': 'Diesel',
                'cng': 'CNG',
                'electric': 'Electric',
                'hybrid': 'Hybrid'
            };
            return fuelMap[fuel] || fuel;
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        // Generate booking ID
        function generateBookingId() {
            const timestamp = Date.now().toString().slice(-6);
            const bookingId = `MX-2025-${timestamp}`;
            document.getElementById('bookingId').textContent = bookingId;
        }

        // Copy booking ID
        function copyBookingId() {
            const bookingId = document.getElementById('bookingId').textContent;
            navigator.clipboard.writeText(bookingId).then(() => {
                // Show temporary feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('bg-green-600');
                button.classList.remove('bg-blue-600');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
            });
        }

        // Send data to admin panel (simulated)
        function sendToAdminPanel() {
            const bookingData = JSON.parse(sessionStorage.getItem('bookingData') || '{}');
            
            if (Object.keys(bookingData).length === 0) {
                console.error('No booking data available to send to admin panel');
                return;
            }
            
            const adminData = {
                ...bookingData,
                bookingId: document.getElementById('bookingId').textContent,
                timestamp: new Date().toISOString(),
                status: 'confirmed',
                customerInfo: {
                    name: bookingData.fullName,
                    email: bookingData.email,
                    phone: bookingData.phone,
                    address: bookingData.address
                },
                serviceDetails: {
                    service: bookingData.service,
                    estimatedTime: bookingData.estimatedTime,
                    appointmentDate: bookingData.appointmentDate
                },
                vehicleDetails: {
                    company: bookingData.carCompany,
                    model: bookingData.carModel,
                    number: bookingData.carNumber,
                    fuelType: bookingData.fuelType
                }
            };

            // Simulate API call to admin panel
            console.log('Sending booking data to admin panel:', adminData);
            
            // In a real application, this would be:
            // fetch('/api/admin/bookings', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(adminData)
            // });
        }

        // Show admin notification
        function showAdminNotification() {
            setTimeout(() => {
                const notification = document.getElementById('adminNotification');
                notification.classList.remove('hidden');
                
                // Hide after 5 seconds
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 5000);
            }, 2000);
        }

        // Start rating timer
        function startRatingTimer() {
            ratingTimer = setTimeout(() => {
                showRatingModal();
            }, 60000); // 1 minute
        }

        // Show rating modal
        function showRatingModal() {
            document.getElementById('ratingModal').classList.remove('hidden');
            document.getElementById('ratingModal').classList.add('flex');
        }

        // Set rating
        function setRating(rating) {
            currentRating = rating;
            
            // Update star display
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('unfilled');
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                    star.classList.add('unfilled');
                }
            });

            // Enable submit button
            document.getElementById('submitRatingBtn').disabled = false;
            document.getElementById('submitRatingBtn').classList.remove('disabled:bg-gray-300', 'disabled:cursor-not-allowed');
        }

        // Submit rating
        function submitRating() {
            if (currentRating === 0) return;

            const comment = document.getElementById('ratingComment').value;
            const bookingId = document.getElementById('bookingId').textContent;
            
            const ratingData = {
                bookingId: bookingId,
                rating: currentRating,
                comment: comment,
                timestamp: new Date().toISOString()
            };

            // Update the booking in localStorage with rating
            updateBookingWithRating(bookingId, ratingData);

            // Send rating to admin panel
            console.log('Sending rating data to admin panel:', ratingData);

            // Hide rating modal
            document.getElementById('ratingModal').classList.add('hidden');
            document.getElementById('ratingModal').classList.remove('flex');

            // Show thank you modal
            showThankYouModal();

            // In a real application, this would be:
            // fetch('/api/admin/ratings', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(ratingData)
            // });
        }

        // Update booking with rating in localStorage
        function updateBookingWithRating(bookingId, ratingData) {
            const existingHistory = JSON.parse(localStorage.getItem('bookingHistory') || '[]');
            const bookingIndex = existingHistory.findIndex(booking => booking.bookingId === bookingId);
            
            if (bookingIndex !== -1) {
                existingHistory[bookingIndex].rating = ratingData.rating;
                existingHistory[bookingIndex].ratingComment = ratingData.comment;
                existingHistory[bookingIndex].ratingTimestamp = ratingData.timestamp;
                existingHistory[bookingIndex].rated = true;
                
                localStorage.setItem('bookingHistory', JSON.stringify(existingHistory));
                console.log('Rating updated in booking history');
            }
        }

        // Skip rating
        function skipRating() {
            // Hide rating modal
            document.getElementById('ratingModal').classList.add('hidden');
            document.getElementById('ratingModal').classList.remove('flex');

            // Show thank you modal with different message
            showThankYouModal(true);
        }

        // Show thank you modal
        function showThankYouModal(skipped = false) {
            const thankYouModal = document.getElementById('thankYouModal');
            const message = document.getElementById('thankYouMessage');
            
            if (skipped) {
                message.textContent = "Thank you for using MechXpress! We look forward to serving you.";
            } else {
                const ratingText = currentRating === 5 ? "excellent" : 
                                 currentRating >= 4 ? "great" : 
                                 currentRating >= 3 ? "good" : "valuable";
                message.textContent = `Thank you for your ${ratingText} feedback! It helps us improve our services.`;
            }

            thankYouModal.classList.remove('hidden');
            thankYouModal.classList.add('flex');
        }

        // Close thank you modal
        function closeThankYou() {
            document.getElementById('thankYouModal').classList.add('hidden');
            document.getElementById('thankYouModal').classList.remove('flex');
        }

        // View bookings - redirect to history page
        function viewBookings() {
            window.location.href = 'bookingHistory.html';
        }

        // Clear session data when leaving page
        window.addEventListener('beforeunload', function() {
            sessionStorage.removeItem('bookingData');
            if (ratingTimer) {
                clearTimeout(ratingTimer);
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>